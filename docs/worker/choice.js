!function(t){var e={};function i(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(n,r,function(e){return t[e]}.bind(null,r));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=5)}([function(t,e,i){"use strict";function n(t,e){for(let i of t.line_info)for(let t=0;t<4;++t){let n=i[t]+e.param[t];if(4==n||-4==n)return!0}return!1}function r(t,e){let i,n;for(let r=0;r<4;++r)for(let s=0;s<4;++s){if(null!=t.onboard[r][s])continue;let l=t.clone();if(l.setBoard(r,s,e),l.isQuarto())return[r,s];i=r,n=s}return[i,n]}function s(t,e){let i=[];for(let r of e)n(t,r)||i.push(r);return i}function l(t,e,i){let r=t.getIsBlankList();if(0==e.piecelist.length)return r;for(let s=0;s<4;++s)for(let l=0;l<4;++l){if(!r[s][l])continue;let a=t.clone();if(a.setBoard(s,l,i),a.isRiichi()){let t=!1;for(p of e.piecelist)if(!n(a,p)){t=!0;break}r[s][l]=t}}return r}function a(t){return t=Math.floor(t),Math.floor(Math.random()*t)}function o(t){let e=[];for(let i=0;i<4;++i)for(let n=0;n<4;++n)t[i][n]&&e.push([i,n]);return e}function h(t){for(let e=0;e<t.length;++e)for(let i=0;i<t[e].length;++i)if(t[e][i])return!0;return!1}function u(t){let e=t[0],i=0;for(let n=1;n<t.length;++n)e<t[n]&&(i=n,e=t[n]);return i}function c(t){let e=0;for(let i=0;i<t.length;++i)e+=t[i];return e}function f(t){let e=new Array(t);for(let t=0;t<e.length;++t)e[t]=0;return e}i.d(e,"c",function(){return n}),i.d(e,"d",function(){return r}),i.d(e,"g",function(){return s}),i.d(e,"f",function(){return l}),i.d(e,"h",function(){return a}),i.d(e,"e",function(){return o}),i.d(e,"a",function(){return h}),i.d(e,"b",function(){return u}),i.d(e,"i",function(){return c}),i.d(e,"j",function(){return f});class p{static open(t){}static close(){}static print(t){}}},function(t,e,i){"use strict";i.d(e,"a",function(){return n});class n{constructor(t,e,i,n){this.param=[t,e,i,n];let r=1==t?1:0,s=1==e?1:0,l=1==i?1:0,a=1==n?1:0;this.index=(r<<0)+(s<<1)+(l<<2)+(a<<3)}toDict(){return{color:1==this.param[0]?"light":"dark",shape:1==this.param[1]?"circular":"square",top:1==this.param[2]?"hollow":"solid",height:1==this.param[3]?"tall":"short"}}toNumList(){let t=new Array(4);for(let e=0;e<4;++e)t[e]=1==this.param[e]?1:2;return t}static getInstance(t){let e="light"==t.color?1:0,i="circular"==t.shape?1:0,n="hollow"==t.top?1:0,s="tall"==t.height?1:0;return r[(e<<0)+(i<<1)+(n<<2)+(s<<3)]}static getAllPiece(){return r.slice()}}const r=[new n(-1,-1,-1,-1),new n(1,-1,-1,-1),new n(-1,1,-1,-1),new n(1,1,-1,-1),new n(-1,-1,1,-1),new n(1,-1,1,-1),new n(-1,1,1,-1),new n(1,1,1,-1),new n(-1,-1,-1,1),new n(1,-1,-1,1),new n(-1,1,-1,1),new n(1,1,-1,1),new n(-1,-1,1,1),new n(1,-1,1,1),new n(-1,1,1,1),new n(1,1,1,1)]},function(t,e,i){"use strict";i.d(e,"a",function(){return r});var n=i(1);class r{constructor(t=null,e=null){if(this.piecelist=null,t){let e=[];for(let i of t){let t=n.a.getInstance(i);e.push(t)}this.piecelist=e}if(e){this.piecelist=n.a.getAllPiece();for(let t=0;t<4;++t)for(let i=0;i<4;++i){let n=e.onboard[t][i];n&&this.remove(n)}}}clone(){let t=new r;return t.piecelist=this.piecelist.slice(),t}remove(t){for(let e=0;e<this.piecelist.length;++e)this.piecelist[e]==t&&this.piecelist.splice(e,1)}toDict(){let t=[];for(let e of this.piecelist)t.push(e.toDict());return t}isEmpty(){return 0==this.piecelist.length}}},function(t,e,i){"use strict";i.d(e,"a",function(){return s});var n=i(1);class r{constructor(t=null){this.init(t)}init(t){if(this.onboard=null,t){this.onboard=[[null,null,null,null],[null,null,null,null],[null,null,null,null],[null,null,null,null]];for(let e=0;e<t.length;++e){let i=t[e];i.piece&&this.setBoard(i.left,i.top,n.a.getInstance(i.piece))}}}setBoard(t,e,i){this.onboard[t][e]=i}getBoard(t,e){return this.onboard[t][e]}toList(){return this.onboard}toDict(){let t=[];for(let e=0;e<4;++e)for(let i=0;i<4;++i){let n=this.onboard[e][i];n&&(n=n.toDict());let r={left:e,top:i,piece:n};t.push(r)}return t}}class s extends r{constructor(t=null){super(t)}init(t){if(this.countPiecesNum=0,this.line_info=null,t){this.line_info=new Array(10);for(let t=0;t<10;++t)this.line_info[t]=[0,0,0,0]}super.init(t)}setBoard(t,e,i){if(super.setBoard(t,e,i),i){let n=e,r=t+4;l(this.line_info[n],i.param),l(this.line_info[r],i.param),t==e&&l(this.line_info[8],i.param),t+e==3&&l(this.line_info[9],i.param)}++this.countPiecesNum}isQuarto(){for(let t=0;t<10;++t)for(let e=0;e<4;++e){let i=this.line_info[t][e];if(4==Math.abs(i))return!0}return!1}isRiichi(){for(let t=0;t<10;++t)for(let e=0;e<4;++e){let i=this.line_info[t][e];if(3==Math.abs(i))return!0}return!1}getIsBlankList(){let t=[new Array(4),new Array(4),new Array(4),new Array(4)];for(let e=0;e<4;++e)for(let i=0;i<4;++i)t[e][i]=null==this.onboard[e][i];return t}getPiecesNum(){return this.countPiecesNum}clone(){let t=new s;t.onboard=new Array(4);for(let e=0;e<4;++e){t.onboard[e]=new Array(4);for(let i=0;i<4;++i)t.onboard[e][i]=this.onboard[e][i]}t.line_info=new Array(10);for(let e=0;e<10;++e){t.line_info[e]=new Array(4);for(let i=0;i<4;++i)t.line_info[e][i]=this.line_info[e][i]}return t.countPiecesNum=this.countPiecesNum,t}}function l(t,e){for(let i=0;i<t.length;++i)t[i]+=e[i]}},function(t,e,i){"use strict";class n{choice(t,e){}put(t,e){}}i(3);var r=i(2),s=(i(1),i(0));class l extends n{choice(t,e){t=t.clone(),e=e.clone();let i=s.h(e.piecelist.length),n=e.piecelist[i],r=s.g(t,e.piecelist),l=r.length;0!=l&&(n=r[i=s.h(l)]);let a=t.isQuarto()?"Quarto":"Non";return{piece:n.toDict(),call:a}}put(t,e){t=t.clone();let i=new r.a(null,t);i.remove(e);let n=s.f(t,i,e),l=s.e(n);0==l.length&&(l=s.e(t.getIsBlankList()));let a=s.h(l.length),o=l[a][0],h=l[a][1];if(s.c(t,e)){let i=s.d(t,e);o=i[0],h=i[1]}return t.setBoard(o,h,e),{call:t.isQuarto()?"Quarto":"Non",left:o,top:h}}}function a(t,e,i,n=1.5,r=100){let s=t.slice();for(let l=0;l<t.length;++l){if(0==t[l]){s[l]=r;continue}let a=t[l];s[l]=e[l]/a+n*Math.sqrt(2*Math.log(i)/a)}return s}class o{constructor(){this.playoutTimelimit=1e3,this.ucb1_c=1,this.ucb1_fpu=100,this.playoutDepthBorder=4,this.putCgt=10,this.choiceCgt=11}}class h extends n{constructor(t=new o){super(),this.param=t}choice(t,e){t=t.clone();let i=null;if(16==(e=e.clone()).piecelist.length){let t=s.h(e.piecelist.length);i=e.piecelist[t]}else{let n=new f(t,e,null,!0,this.param);i=n.runChoice(),n.releaseRelation()}let n=t.isQuarto()?"Quarto":"Non";return{piece:i.toDict(),call:n}}put(t,e){t=t.clone();let i=new r.a(null,t);i.remove(e);let n=new f(t,i,e,!0,this.param),s=n.runPut();n.releaseRelation();let l=s[0],a=s[1];return t.setBoard(l,a,e),{call:t.isQuarto()?"Quarto":"Non",left:l,top:a}}}class u{constructor(t,e,i,n){this.board=t,this.box=e,this.piece=i,this.myturn=n,this.winner=null}run(){for(;null==this.winner;)if(null==this.piece){if(0==this.box.piecelist.length)break;this.choiceRand(),this.myturn=!this.myturn}else if(this.putRand(),0==this.box.piecelist.length)break;return this.winner}putRand(){if(s.c(this.board,this.piece))return void(this.winner=this.myturn);let t=s.f(this.board,this.box,this.piece);if(!s.a(t))return void(this.winner=!this.myturn);let e=s.e(t),i=s.h(e.length);this.board.setBoard(e[i][0],e[i][1],this.piece),this.piece=null}choiceRand(){let t=s.g(this.board,this.box.piecelist),e=t.length;if(0==e)return void(this.winner=!this.myturn);let i=s.h(e);this.piece=t[i],this.box.remove(this.piece)}}class c{constructor(){this.myturn=!0,this.winner=!1,this.isLeaf=!1,this.branchlostcounter=0,this.leafcounter=0,this.branchnum=1}onLeaf(){}}class f{constructor(t,e,i,n,r,s=new c){this.board=t,this.box=e,this.piece=i,this.myturn=n,this.param=r,this.branchList=null,this.left=null,this.top=null,this.branchnum=0,this.branchPlayoutCount=null,this.branchPlayoutWin=null,this.branchPlayoutDraw=null,this.branchPlayoutTotal=0,this.branchPlayoutTarget=0,this.branchlostcounter=0,this.leafcounter=0,this.isLeaf=!1,this.winner=null,this.parent=s}runChoice(){let t=this.board.getPiecesNum()>=this.param.choiceCgt;if(this.createChoiceBranch(t),null==this.branchList)return this.box.piecelist[0];let e=this.searchRoute();return this.branchList[e].piece}runPut(){if(s.c(this.board,this.piece))return s.d(this.board,this.piece);let t=this.board.getPiecesNum()>=this.param.putCgt;if(this.createPutBranch(t),null==this.branchList){return s.e(this.board.getIsBlankList())[0]}let e=this.searchRoute();return[this.branchList[e].left,this.branchList[e].top]}createChoiceBranch(t){if(this.box.isEmpty())return this.isLeaf=!0,void this.onLeaf();let e=s.g(this.board,this.box.piecelist);if(this.branchnum=e.length,0==this.branchnum)return this.winner=!this.myturn,this.isLeaf=!0,void this.onLeaf();this.branchList=[];for(let t of e){let e=this.box.clone();e.remove(t);let i=new f(this.board.clone(),e,t,!this.myturn,this.param,this);this.branchList.push(i)}t?this.createChoiceCgt():this.playoutinit()}createChoiceCgt(){for(let t of this.branchList)if(t.createPutBranch(!0),t.branchList=null,this.isLeaf)break}createPutBranch(t){if(s.c(this.board,this.piece))return this.winner=this.myturn,this.isLeaf=!0,void this.onLeaf();if(this.box.isEmpty())return this.isLeaf=!0,void this.onLeaf();let e=s.f(this.board,this.box,this.piece),i=s.e(e);if(this.branchnum=i.length,0==this.branchnum)return this.winner=!this.myturn,this.isLeaf=!0,void this.onLeaf();this.branchList=[];for(let t of i){let e=t[0],i=t[1],n=this.board.clone();n.setBoard(e,i,this.piece);let r=new f(n,this.box.clone(),null,this.myturn,this.param,this);r.left=e,r.top=i,this.branchList.push(r)}t?this.createPutCgt():this.playoutinit()}createPutCgt(){for(let t of this.branchList)if(t.createChoiceBranch(!0),t.branchList=null,this.isLeaf)break}playoutinit(){this.branchPlayoutCount=s.j(this.branchnum),this.branchPlayoutWin=s.j(this.branchnum),this.branchPlayoutDraw=s.j(this.branchnum),this.branchPlayoutTotal=0,this.branchPlayoutTarget=0,this.branchlostcounter=0}onLeaf(){return this.parent.leafcounter+=1,this.parent.myturn==this.winner?(this.parent.winner=this.winner,this.parent.isLeaf=!0,void this.parent.onLeaf()):!this.parent.myturn==this.winner&&(this.parent.branchlostcounter+=1,this.parent.branchlostcounter==this.parent.branchnum)?(this.parent.winner=this.winner,this.parent.isLeaf=!0,void this.parent.onLeaf()):this.parent.leafcounter==this.parent.branchnum?(this.parent.isLeaf=!0,void this.parent.onLeaf()):void 0}playout(){if(this.isLeaf)return this.winner;if(null==this.branchList)return new u(this.board.clone(),this.box.clone(),this.piece,this.myturn).run();this.branchPlayoutCount[this.branchPlayoutTarget]+=1,this.branchPlayoutTotal+=1;let t=this.branchList[this.branchPlayoutTarget];if(this.branchPlayoutCount[this.branchPlayoutTarget]==this.param.playoutDepthBorder&&null==t.branchList)if(null==t.piece){let e=t.board.getPiecesNum()>=this.param.choiceCgt;t.createChoiceBranch(e)}else{let e=t.board.getPiecesNum()>=this.param.putCgt;t.createPutBranch(e)}let e,i=t.playout();return i==this.myturn?this.branchPlayoutWin[this.branchPlayoutTarget]+=1:null==i&&(this.branchPlayoutDraw[this.branchPlayoutTarget]+=1),e=0!=s.i(this.branchPlayoutWin)?a(this.branchPlayoutCount,this.branchPlayoutWin,this.branchPlayoutTotal,this.param.ucb1_c,this.param.ucb1_fpu):a(this.branchPlayoutCount,this.branchPlayoutDraw,this.branchPlayoutTotal,this.param.ucb1_c,this.param.ucb1_fpu),this.branchPlayoutTarget=s.b(e),i}searchRoute(){if(!this.isLeaf){let t=(new Date).getTime()+this.param.playoutTimelimit;for(;(new Date).getTime()<t&&(this.playout(),!this.isLeaf););}let t=-1,e=-1;for(let i=0;i<this.branchnum;++i){if(this.branchList[i].winner){t=i;break}null==this.branchList[i].winner&&(this.isLeaf?t=i:e<this.branchPlayoutCount[i]&&(e=this.branchPlayoutCount[i],t=i))}return-1==t&&(t=this.isLeaf?0:s.b(this.branchPlayoutCount)),t}releaseRelation(){if(null!=this.branchList)for(let t of this.branchList)t.releaseRelation();this.branchList=null,this.parent=null}}function p(t){switch(t){case"AiMontecarlo":return new h;case"AiRandom":return new l}return null}i.d(e,"a",function(){return p})},function(t,e,i){"use strict";i.r(e);var n=i(3),r=i(2),s=i(4);onmessage=function(t){let e=Object(s.a)(t.data.aiName),i=new n.a(t.data.in_board),l=new r.a(t.data.in_box);postMessage(e.choice(i,l))}}]);